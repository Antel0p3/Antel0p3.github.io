<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>J-Spring | Antel0p3&#39;s blog</title>
  <meta name="author" content="John Doe">
  
  <meta name="description" content="Spring学习1、Spring框架体系
2、 IOC2.1 什么是IOCIoC (Inversion of Control) : 控制反转， 是一个理论，概念，思想。把对象的创建，赋值，管理工作都交给代码之外的容器实现， 也就是对象的创建是有其它外部资源完成，这样做实现了解耦合。  
正转：对象的">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="J-Spring"/>
  <meta property="og:site_name" content="Antel0p3&#39;s blog"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="Antel0p3&#39;s blog" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70812759-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70812759-1');
</script>






<meta name="generator" content="Hexo 6.3.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Antel0p3&#39;s blog</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


					
							<div class="page-header">
								<h1>
									
											
												J-Spring
									
									
								</h1>
								
									<p id="/2024/02/22/J-Spring/" class="leancloud-visitors view"
										data-flag-title="J-Spring">
										<i class="fa fa-eye"></i> <i class="leancloud-visitors-count"></i>
									</p>
									
							</div>
							
								

<div class="row post">
	<!-- cols -->
	
	<div id="top_meta">
		
	</div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h1 id="Spring学习"><a href="#Spring学习" class="headerlink" title="Spring学习"></a>Spring学习</h1><h2 id="1、Spring框架体系"><a href="#1、Spring框架体系" class="headerlink" title="1、Spring框架体系"></a>1、Spring框架体系</h2><p><img src="https://pic1.zhimg.com/80/v2-757fe480803898af4bb97bb270c8c508_720w.webp"></p>
<h2 id="2、-IOC"><a href="#2、-IOC" class="headerlink" title="2、 IOC"></a>2、 IOC</h2><h4 id="2-1-什么是IOC"><a href="#2-1-什么是IOC" class="headerlink" title="2.1 什么是IOC"></a><strong>2.1 什么是IOC</strong></h4><p>IoC (Inversion of Control) : 控制反转， 是一个理论，概念，思想。把对象的创建，赋值，管理工作都交给代码之外的容器实现， 也就是对象的创建是有其它外部资源完成，这样做实现了解耦合。  </p>
<p>正转：对象的创建、赋值等操作交由程序员手动完成，即使用类似new Xxx(Xxx Xxx)、Xxx.setXxx()语句完成对象的创建与赋值，缺点是一旦程序功能发生改变，涉及到的类就要修改代理，耦合度高，不便于维护和管理。<br>反转：对象的创建、赋值等操作交由代码之外的容器实现，有容器代替程序员完成对象的创建、赋值；且当程序功能发生变化时，只需要修改容器的配置文件即可。</p>
<p><strong>java实现创建对象的方式有哪些</strong></p>
<blockquote>
<p>1、构造方法：new student()<br>2、反射<br>3、序列化<br>4、动态代理<br>5、容器：tomcat容器、ioc容器</p>
</blockquote>
<p>容器创建对象的场景：在tomcat服务器启动时会实例化servletContext上下文对象；在发出请求时，相应的servlet对象也不是由开发人员进行实例化的，而是在tomcat内部由tomcat容器实例化的</p>
<h3 id="2-3-基于配置文件的di实现"><a href="#2-3-基于配置文件的di实现" class="headerlink" title="2.3 基于配置文件的di实现"></a>2.3 基于配置文件的di实现</h3><h4 id="2-3-1-什么是di"><a href="#2-3-1-什么是di" class="headerlink" title="2.3.1 什么是di"></a><strong>2.3.1 什么是di</strong></h4><blockquote>
<p>DI（Dependency Injection） :依赖注入， 只需要在程序中提供要使用的对象名称就可以， 至于对象如何在容器中创建， 赋值，查找都由容器内部实现。<br>DI是ioc技术的实现方式（即容器如何创建对象这一问题的实现方式）</p>
</blockquote>
<h4 id="2-3-2-入门案例"><a href="#2-3-2-入门案例" class="headerlink" title="2.3.2 入门案例"></a><strong>2.3.2 入门案例</strong></h4><p>使用ioc容器创建对象，调用对象的方法</p>
<h4 id="2-3-3-环境搭建"><a href="#2-3-3-环境搭建" class="headerlink" title="2.3.3 环境搭建"></a><strong>2.3.3 环境搭建</strong></h4><blockquote>
<p>创建maven项目，目前都是javase项目，推荐使用骨架，选择quickstart<br>加入maven依赖：分别是spring依赖、junit依赖<br>创建类（接口和它的实现类）<br>创建spring需要使用的配置文件<br>测试</p>
</blockquote>
<p>maven依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>接口和实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SomeService</span> &#123;</span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">doSome</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SomeServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SomeService</span> &#123;</span><br><span class="line">    <span class="comment">//无参构造</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SomeServiceImpl</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SomeServiceImpl类的无参构造执行了...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSome</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行了SomeServiceImpl的doSome()方法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ioc配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        声明bean（告诉spring要创建某个类的对象）</span></span><br><span class="line"><span class="comment">        1、id：自定义名称，唯一值，spring通过该id的属性值找到对象</span></span><br><span class="line"><span class="comment">        2、class：要创建类的全限定类名</span></span><br><span class="line"><span class="comment">        3、下述的声明语句在spring底层类似与执行了以下代码：</span></span><br><span class="line"><span class="comment">            SomeService service = new SomeServiceImpl();</span></span><br><span class="line"><span class="comment">        4、对象的保存：</span></span><br><span class="line"><span class="comment">            spring将对象保存到内部的map中，map.put(id值，对象)</span></span><br><span class="line"><span class="comment">            map.put(&quot;someService&quot;,new SomeServiceImpl())</span></span><br><span class="line"><span class="comment">        5、一个bean标签声明一个java对象</span></span><br><span class="line"><span class="comment">        6、spring容器根据bean标签创建对象，尽管存在class属性相同的bean标签，只要是id值不同，</span></span><br><span class="line"><span class="comment">           spring容器就会创建该class的对象</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;someService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mms.service.impl.SomeServiceImpl&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;someService2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mms.service.impl.SomeServiceImpl&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        spring容器也可以创建非自定义类的对象，例如java.lang.String类的对象，只要指定了</span></span><br><span class="line"><span class="comment">        class属性，spring容器就可以创建该类的对象</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myString&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.String&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试程序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用spring容器创建对象</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1、指定spring配置文件的名称</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">config</span> <span class="operator">=</span> <span class="string">&quot;beans.xml&quot;</span>;</span><br><span class="line">        <span class="comment">//2、创建表示spring容器的对象 ApplicationContext</span></span><br><span class="line">        <span class="comment">//ClassPathXmlApplicationContext：表示从类路径中加载spring配置文件</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(config);</span><br><span class="line">        <span class="comment">//3、从容器中获取对象</span></span><br><span class="line">        <span class="type">SomeService</span> <span class="variable">service</span> <span class="operator">=</span> (SomeService)ac.getBean(<span class="string">&quot;someService&quot;</span>);</span><br><span class="line">        <span class="comment">//4、调用方法</span></span><br><span class="line">        service.doSome();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试spring容器创建对象的时机</span></span><br><span class="line"><span class="comment">     *  在创建spring容器时，会创建配置文件中的所有对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1、指定spring配置文件路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">config</span> <span class="operator">=</span> <span class="string">&quot;beans.xml&quot;</span>;</span><br><span class="line">        <span class="comment">//2、创建spring容器</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(config);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 测试输出结果：</span></span><br><span class="line"><span class="comment">         * SomeServiceImpl类的无参构造执行了...</span></span><br><span class="line"><span class="comment">         * SomeServiceImpl类的无参构造执行了...</span></span><br><span class="line"><span class="comment">         * 验证了spring调用类的无参构造完成对象的创建</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取spring容器中java对象的信息</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">config</span> <span class="operator">=</span> <span class="string">&quot;beans.xml&quot;</span>;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(config);</span><br><span class="line">        <span class="comment">//获取spring容器中对象的个数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">beansCount</span> <span class="operator">=</span> ac.getBeanDefinitionCount();</span><br><span class="line">        System.out.println(<span class="string">&quot;spring容器中的对象个数=&quot;</span>+beansCount);</span><br><span class="line">        <span class="comment">//获取spring容器中对象的名称（即bean标签的id值）</span></span><br><span class="line">        String[] beansNames = ac.getBeanDefinitionNames();</span><br><span class="line">        <span class="keyword">for</span> (String beanName : beansNames) &#123;</span><br><span class="line">            System.out.println(beanName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-4-案例总结"><a href="#2-3-4-案例总结" class="headerlink" title="2.3.4 案例总结"></a><strong>2.3.4 案例总结</strong></h4><blockquote>
<p>spring配置文件中一个bean标签就代表一个对象，该对象有bean标签的id值唯一标识，从spring拿对象是使用getBean(“bean标签的id值”)<br>spring默认是使用类的无参构造来创建对象的</p>
</blockquote>
<h4 id="2-3-5-简单类型属性的赋值（set注入）"><a href="#2-3-5-简单类型属性的赋值（set注入）" class="headerlink" title="2.3.5 简单类型属性的赋值（set注入）"></a><strong>2.3.5 简单类型属性的赋值（set注入）</strong></h4><p>在入门案例的总结我们说过了spring容器默认是使用无参构造构造来实例化对象的，那么对象的属性必定为初始值，例如int类型为0，boolean类型为false等，那么当我们想使用相关属性进行操作时必然要手动使用set方法给属性赋值，那么有没有办法让容器帮我们完成对象属性的赋值呢？让我们直接就能够从容器中拿到有属性值的对象？答案是肯定的，下面就通过代码演示简单类型的属性赋值。</p>
<p><strong>set注入要求</strong></p>
<blockquote>
<p>JavaBean必须要有set方法，因为ioc容器是使用javabean的set方法进行属性赋值的<br>spring容器调用的是setXxx()方法，而不管对象是否具有Xxx属性（即对象没有的属性只要有set方法也可以实现注入），Xxx不区分大小写</p>
</blockquote>
<p>看看代码：</p>
<p><strong>JavaBean</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> School school;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSchool</span><span class="params">(School school)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.school = school;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, school=&quot;</span> + school +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>spring配置文件</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--声明Student对象--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;student&quot;</span> class=<span class="string">&quot;com.mms.component.Student&quot;</span>&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">            <span class="number">1</span>、简单类型使用property和value标签给对象属性赋值</span><br><span class="line">            <span class="number">2</span>、简单类型：<span class="number">8</span>个基本类型+String</span><br><span class="line">            <span class="number">3</span>、当spring容器加载到这一行时会在创建完对象的同时使用对象的set方法给属性赋值，底层</span><br><span class="line">               调用的是对象的set方法</span><br><span class="line">            <span class="number">4</span>、spring容器调用的是setXxx()方法，而不管对象是否具有Xxx属性，Xxx不区分大小写</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;张三&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;age&quot;</span> value=<span class="string">&quot;23&quot;</span>/&gt;</span><br><span class="line">        &lt;!--测试对象没有属性的set方法--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;graName&quot;</span> value=<span class="string">&quot;s1&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p><strong>测试类</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">//使用set注入给对象属性赋值</span><br><span class="line">    @Test</span><br><span class="line">    public void test01() &#123;</span><br><span class="line">        String config = &quot;ba01/applicationContext.xml&quot;;</span><br><span class="line">        ApplicationContext ac = new ClassPathXmlApplicationContext(config);</span><br><span class="line">        //执行完14行此时Student对象的属性已被赋值，获取对象进行验证</span><br><span class="line">        Student stu = (Student) ac.getBean(&quot;student&quot;);</span><br><span class="line">        System.out.println(stu); //Student&#123;name=&#x27;张三&#x27;, age=23&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //验证set注入调用的是对象的set方法</span><br><span class="line">    @Test</span><br><span class="line">    public void test02() &#123;</span><br><span class="line">        String config = &quot;ba01/applicationContext.xml&quot;;</span><br><span class="line"></span><br><span class="line">        /*</span><br><span class="line">         * 此时会调用set方法进行赋值</span><br><span class="line">         * setName...</span><br><span class="line">         * setAge...</span><br><span class="line">         */</span><br><span class="line">        ApplicationContext ac = new ClassPathXmlApplicationContext(config);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //验证没有属性的setXxx方法是否报错</span><br><span class="line">    @Test</span><br><span class="line">    public void test03() &#123;</span><br><span class="line">        String config = &quot;ba01/applicationContext.xml&quot;;</span><br><span class="line">        ApplicationContext ac = new ClassPathXmlApplicationContext(config);</span><br><span class="line">        //获取对象</span><br><span class="line">        Student stu = (Student) ac.getBean(&quot;student&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-6-非简单类型属性的赋值（set注入）"><a href="#2-3-6-非简单类型属性的赋值（set注入）" class="headerlink" title="2.3.6 非简单类型属性的赋值（set注入）"></a><strong>2.3.6 非简单类型属性的赋值（set注入）</strong></h4><p>上文中的set注入使用property标签的name和value属性给对象属性赋值，但是value知识给简单类型属性赋值，对于非简单类型我们是使用property标签的name和ref属性给对象属性赋值。我们现在给Student类增加一个属性address，该属性是一个引用类型，那当ioc容器创建Student对象时如何给address属性赋值呢？</p>
<p><strong>Student类：别的地方与上文的student类一致，这里只给出address属性和其set方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引用类型属性</span></span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddress</span><span class="params">(Address address)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;引用类型address的set方法执行了...&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>Address类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String homeAddress;</span><br><span class="line">    <span class="keyword">private</span> String schoolAddress;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHomeAddress</span><span class="params">(String homeAddress)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.homeAddress = homeAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSchoolAddress</span><span class="params">(String schoolAddress)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.schoolAddress = schoolAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Address&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;homeAddress=&#x27;&quot;</span> + homeAddress + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, schoolAddress=&#x27;&quot;</span> + schoolAddress + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>applicationContext.xml配置文件</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--声明Student对象--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;student&quot;</span> class=<span class="string">&quot;com.mms.component.Student&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;张三&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;age&quot;</span> value=<span class="string">&quot;23&quot;</span>/&gt;</span><br><span class="line">        &lt;!--测试对象没有属性的set方法--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;graName&quot;</span> value=<span class="string">&quot;s1&quot;</span>/&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">            引用类型属性的set注入</span><br><span class="line">            property标签属性</span><br><span class="line">                name：属性名</span><br><span class="line">                ref：引用对象的id值</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;address&quot;</span> ref=<span class="string">&quot;address&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--Student对象的引用属性Address--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;address&quot;</span> class=<span class="string">&quot;com.mms.component.Address&quot;</span>&gt;</span><br><span class="line">        &lt;!--set注入--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;homeAddress&quot;</span> value=<span class="string">&quot;新疆&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;schoolAddress&quot;</span> value=<span class="string">&quot;西安&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>上文执行流程分析：当ioc容器创建id为student的对象时，会进行set注入，当执行到最后一个property标签时发现使用了ref属性，则ioc容器知道了name为address的属性是非简单类型，它就会暂时跳过address属性的赋值以及Student对象的创建，转而去配置文件的下文去找bean标签id值等于ref属性值的对象，现将该对象创建，再将该对象赋值给之前的address属性并将Student对象创建。</p>
<h4 id="2-3-7-构造注入"><a href="#2-3-7-构造注入" class="headerlink" title="2.3.7 构造注入"></a><strong>2.3.7 构造注入</strong></h4><p>顾名思义，构造注入是使用javabean的构造方法进行属性的赋值的。与set注入一样，构造注入要求javabean必须提供构造方法，且必须是有参构造（如果是无参构造还怎么给属性赋值，对吧），构造注入使用较少，了解就可以了，我们一般使用set注入。看看代码吧，将Student类的set方法注释，加入构造方法，别的地方不用改变，只需要改变spring配置文件即可（这里就可以看出ioc容器与程序的解耦合的好处了）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">        构造注入</span><br><span class="line">        <span class="number">1</span>、使用constructor-arg标签完成构造注入</span><br><span class="line">        <span class="number">2</span>、构造注入方式一：根据形参名字</span><br><span class="line">        <span class="number">3</span>、构造注入方式二：根据形参顺序，默认下标从<span class="number">0</span>开始递增</span><br><span class="line">    --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--根据形参名构造注入，形参的出现顺序不是必须的--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;student&quot;</span> class=<span class="string">&quot;com.mms.value.Student&quot;</span>&gt;</span><br><span class="line">        &lt;constructor-arg name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;李四&quot;</span>/&gt;</span><br><span class="line">        &lt;constructor-arg name=<span class="string">&quot;age&quot;</span> value=<span class="string">&quot;24&quot;</span>/&gt;</span><br><span class="line">        &lt;constructor-arg name=<span class="string">&quot;address&quot;</span> ref=<span class="string">&quot;address&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;address&quot;</span> class=<span class="string">&quot;com.mms.value.Address&quot;</span>&gt;</span><br><span class="line">        &lt;constructor-arg name=<span class="string">&quot;homeAddress&quot;</span> value=<span class="string">&quot;新疆&quot;</span>/&gt;</span><br><span class="line">        &lt;constructor-arg name=<span class="string">&quot;schoolAddress&quot;</span> value=<span class="string">&quot;西安&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--构造注入，使用下标，出现的顺序没要求，因为已经通过下标绑定起来了--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;diByContructor&quot;</span> class=<span class="string">&quot;com.mms.value.Student&quot;</span>&gt;</span><br><span class="line">        &lt;constructor-arg index=<span class="string">&quot;0&quot;</span> value=<span class="string">&quot;赵六&quot;</span>/&gt;</span><br><span class="line">        &lt;constructor-arg index=<span class="string">&quot;1&quot;</span> value=<span class="string">&quot;26&quot;</span>/&gt;</span><br><span class="line">        &lt;constructor-arg index=<span class="string">&quot;2&quot;</span> ref=<span class="string">&quot;address&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-8-非简单类型的自动注入"><a href="#2-3-8-非简单类型的自动注入" class="headerlink" title="2.3.8 非简单类型的自动注入"></a><strong>2.3.8 非简单类型的自动注入</strong></h4><p>对于非简单类型，我们在上面是使用ref属性指向一个非简单类型的对象来完成赋值的，那么当ioc容器每次给一个对象的非简单类型属性赋值时，就要在bean标签内部写一行ref这样的代码，这样会造成重复代码的大量堆积，可以使用引用类型的自动注入。</p>
<p>有两种方式的引用类型自动注入  </p>
<blockquote>
<p>byName形式的引用类型自动注入：<br>通过java对象引用类型的属性名与spring容器中bean标签对象的id值一样且数据类型是一致的，这样能够实现引用类型的自动注入<br>byType形式的引用类型自动注入<br>通过java对象引用类型属性的数据类型和spring容器中 bean标签的class属性值是同源关系；<br>常见的同源关系：<br>1）java引用类型属性数据类型和bean标签的class属性值数据类型一样<br>2）java引用类型属性数据类型和bean标签的class属性值数据类型是父子关系<br>3）java引用类型属性数据类型和bean标签的class属性值数据类型是接口和实现类关系<br>注意：在一个配置文件中，符合条件的同源关系只能有一个</p>
</blockquote>
<p>下面通过配置文件来详细说明两种形式的实现，在这里还是以Student类的address属性为例来说明。</p>
<p><strong>byName形式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;student&quot;</span> class=<span class="string">&quot;com.mms.ba03.Student&quot;</span> autowire=<span class="string">&quot;byName&quot;</span>&gt;</span><br><span class="line">        &lt;!--简单类型赋值--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;张三&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;age&quot;</span> value=<span class="string">&quot;23&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!--引用类型--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;school&quot;</span> class=<span class="string">&quot;com.mms.ba03.School&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;schoolName&quot;</span> value=<span class="string">&quot;石河子大学&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;schoolAddress&quot;</span> value=<span class="string">&quot;石河子市&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p><em>匹配详解：</em> 当ioc容器在创建Student对象时，发现使用了autowire属性且属性值为byName，ioc容器就会去Student类中去拿引用类型的属性名与和spring配置文件中的bean标签的id值进行比对，若发现有一致的且数据类型一致，则将该对象赋值给引用类型属性。</p>
<p><strong>byType形式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--使用byType实现引用类型自动注入--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;student2&quot;</span> class=<span class="string">&quot;com.mms.ba03.Student&quot;</span> autowire=<span class="string">&quot;byType&quot;</span>&gt;</span><br><span class="line">        &lt;!--简单类型赋值--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;李四&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;age&quot;</span> value=<span class="string">&quot;24&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!--引用类型</span><br><span class="line">    &lt;bean id=<span class="string">&quot;school2&quot;</span> class=<span class="string">&quot;com.mms.ba03.School&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;schoolName&quot;</span> value=<span class="string">&quot;西南大学&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;schoolAddress&quot;</span> value=<span class="string">&quot;重庆市&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--声明School的子类--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;primarySchool&quot;</span> class=<span class="string">&quot;com.mms.ba03.PrimarySchool&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;schoolName&quot;</span> value=<span class="string">&quot;西北大学&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;schoolAddress&quot;</span> value=<span class="string">&quot;西安&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-基于注解的di实现"><a href="#2-4-基于注解的di实现" class="headerlink" title="2.4 基于注解的di实现"></a>2.4 基于注解的di实现</h3><p>除了使用配置文件实现ioc创建对象的功能外，使用spring提供的注解也可以实现di。下面来介绍注解方式的di实现，下面是spring提供的di实现的常用注解。</p>
<blockquote>
<p>@Component：该注解的功能是使用spring容器创建对象<br>1）、在要创建对象的类的声明上方加入该注解，该注解有一个属性value，value为spring创建的该类对象的id值<br>2）、开发中使用将value省略，直接使用双引号将值键入即可<br>3）、该注解使用类的无参构造创建对象<br>@Repository 创建dao类对象，访问数据库的对象<br>@Service 创建service类对象，业务层对象<br>@Controller 创建控制器对象，用于分发用户的请求和显示处理结果</p>
</blockquote>
<p>下面通过代码来看看@Component注解是怎么实现di的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(value = &quot;student&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该语句就等价为在spring配置文件中进行了以下声明</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="type">bean</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;student&quot;</span> class = <span class="string">&quot;com.mms.component.Student&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>但是怎么让配置文件知道哪些类是使用注解进行创建对象的呢？需要在配置文件中声明组件扫描器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">&quot;com.mms.component&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>当spring读取配置文件时，读取到组件扫描器声明语句时，就会去base-package指定的包和其子包下去递归的寻找有注解修饰的类，并根据注解的功能去执行相应的动作</p>
<h4 id="2-4-1-简单类型的注解di实现"><a href="#2-4-1-简单类型的注解di实现" class="headerlink" title="2.4.1 简单类型的注解di实现"></a><strong>2.4.1 简单类型的注解di实现</strong></h4><p>简单类型的注入使用@Value注解实现，哪些简单类型要设置属性值，直接在简单类型属性声明语句的上面加入注解@Value即可，并在@Value的括号内键入属性值，注意不论简单类型属性的数据类型，均由双引号将属性值括起来。例如之前的Student类使用注解注入如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;student&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;张三&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Value(&quot;23&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意别忘了该类要加注解@Component注解，因为要创建该类对象。</p>
<h4 id="2-4-2-引用类型的注解di实现"><a href="#2-4-2-引用类型的注解di实现" class="headerlink" title="2.4.2 引用类型的注解di实现"></a><strong>2.4.2 引用类型的注解di实现</strong></h4><p>引用类型的注入使用@Autowired注解完成。</p>
<blockquote>
<p>@Autowired<br>@Autowired是spring提供的属性赋值，用于给引用类型赋值，有byName和byType两种方式，默认使用byType方式自动注入<br>若是要强制至于byName方式，要在@Autowired注解下面加入 @Qualifier(value &#x3D; “bean的id”)注解，若程序在给引用类型注入时在xml文件中找不到 该id的bean标签或者手找不到该id的@Component注解，则报错；若不想让程序在赋值失败时报错，可以在@Autowired注解的required属性值置为false</p>
</blockquote>
<p>还是拿Student类的school属性的赋值来举例。</p>
<p><strong>学生类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;student&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="comment">/*引用类型注入（byType方式）</span></span><br><span class="line"><span class="comment">    @Autowired</span></span><br><span class="line"><span class="comment">    private School school;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//引用类型赋值（byName方式）</span></span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="meta">@Qualifier(value = &quot;mySchool&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> School school;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>School类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;mySchool&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">School</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注入值</span></span><br><span class="line">    <span class="meta">@Value(&quot;西南大学&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String schoolAddress;</span><br><span class="line">    <span class="meta">@Value(&quot;新疆&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String homeAddress;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;School&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;schoolAddress=&#x27;&quot;</span> + schoolAddress + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, homeAddress=&#x27;&quot;</span> + homeAddress + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3、AOP"><a href="#3、AOP" class="headerlink" title="3、AOP"></a>3、AOP</h2><h3 id="3-1-动态代理"><a href="#3-1-动态代理" class="headerlink" title="3.1 动态代理"></a>3.1 动态代理</h3><h4 id="3-1-1-jdk动态代理"><a href="#3-1-1-jdk动态代理" class="headerlink" title="3.1.1 jdk动态代理"></a><strong>3.1.1 jdk动态代理</strong></h4><p>使用jdk中的Proxy，Method，InvocaitonHanderl创建代理对象。 jdk动态代理要求目标类必须实现接口，关于细节本文就不赘述了。<br>要求：</p>
<blockquote>
<p>必须要有接口<br>目标类必须实现接口（一个或多个）</p>
</blockquote>
<h4 id="3-1-2-cglib动态代理"><a href="#3-1-2-cglib动态代理" class="headerlink" title="3.1.2 cglib动态代理"></a><strong>3.1.2 cglib动态代理</strong></h4><p>第三方的工具库，创建代理对象，原理是继承。 通过继承目标类，创建子类。子类就是代理对象。 要求目标类不能是final的，方法也不能是final的</p>
<h4 id="3-1-3-动态代理的好处"><a href="#3-1-3-动态代理的好处" class="headerlink" title="3.1.3 动态代理的好处"></a><strong>3.1.3 动态代理的好处</strong></h4><blockquote>
<p>在目标类源代码不改变的情况下，增加功能。<br>减少代码的重复<br>专注业务逻辑代码<br>解耦合，让你的业务功能和日志，事务等非业务功能分离。</p>
</blockquote>
<h4 id="3-2-什么是AOP"><a href="#3-2-什么是AOP" class="headerlink" title="3.2 什么是AOP"></a><strong>3.2 什么是AOP</strong></h4><p>面向切面编程， 基于动态代理的，可以使用jdk，cglib两种代理方式。Aop就是动态代理的规范化， 把动态代理的实现步骤，方式都定义好了， 让开发人员用一种统一的方式，使用动态代理实现。</p>
<h4 id="3-2-1-AOP常用术语"><a href="#3-2-1-AOP常用术语" class="headerlink" title="3.2.1 AOP常用术语"></a><strong>3.2.1 AOP常用术语</strong></h4><blockquote>
<p>Aspect: 切面，给你的目标类增加的功能，就是切面。 像日志，事务都是切面。切面的特点： 一般都是非业务方法，独立使用的。<br>JoinPoint:连接点 ，连接业务方法和切面的位置。需要给哪个方法增加切面，这个方法就是连接点。<br>Pointcut : 切入点 ，指多个连接点方法的集合。<br>目标对象： 给哪个类的方法增加功能， 这个类就是目标对象。<br>Advice:通知，通知表示切面功能执行的时间。</p>
</blockquote>
<h4 id="3-2-2-切面的构成"><a href="#3-2-2-切面的构成" class="headerlink" title="3.2.2 切面的构成"></a><strong>3.2.2 切面的构成</strong></h4><p>切面就是要给别的方法进行增强的方法，一个切面有以下三个要素。</p>
<blockquote>
<p>切面的功能代码，切面干什么<br>切面的执行位置，使用Pointcut表示切面执行的位置<br>切面的执行时间，使用Advice表示时间，在目标方法之前，还是目标方法之后。</p>
</blockquote>
<h3 id="3-3-使用aspectJ框架实现AOP"><a href="#3-3-使用aspectJ框架实现AOP" class="headerlink" title="3.3 使用aspectJ框架实现AOP"></a>3.3 使用aspectJ框架实现AOP</h3><h4 id="3-3-1-aspectJ简介"><a href="#3-3-1-aspectJ简介" class="headerlink" title="3.3.1 aspectJ简介"></a><strong>3.3.1 aspectJ简介</strong></h4><p>aspectJ是一个开源的专门做aop的框架。spring框架中集成了aspectj框架，通过spring就能使用aspectj的功能。aspectJ框架实现aop有两种方式：</p>
<blockquote>
<p>使用xml的配置文件 ： 配置全局事务<br>使用注解，我们在项目中要做aop功能，一般都使用注解， aspectj有5个注解。<br>再使用aspectJ做aop之前要先加入aspectJ依赖。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--aspectJ依赖--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;spring-aspects&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;<span class="number">5.2</span><span class="number">.5</span>.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-2-Before前置通知"><a href="#3-3-2-Before前置通知" class="headerlink" title="3.3.2 @Before前置通知"></a><strong>3.3.2 @Before前置通知</strong></h4><p>前置通知注解修饰的切面在连接点方法之前执行。下面通过一段代码体验一下。</p>
<blockquote>
<p>声明接口IService</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doSome</span><span class="params">(String name, <span class="type">int</span> age)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>声明实现类ServiceImpl</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSome</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;===doSome()===&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>声明切面<br><strong>切面类需要在顶部注解@Aspect</strong>  同时在xml文件中也要注册并加入<code>&lt;aop:aspect-autoproxy/&gt;</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspectJ</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义功能增强方法（方法就是切面）</span></span><br><span class="line"><span class="comment">     * 1、方法的必须为public</span></span><br><span class="line"><span class="comment">     * 2、方法无返回值</span></span><br><span class="line"><span class="comment">     * 3、方法名称自定义</span></span><br><span class="line"><span class="comment">     * 4、方法可以有参数，也可以没有参数</span></span><br><span class="line"><span class="comment">     * 5、方法的定义上方加入注解，表示切入点的执行时机</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    <span class="doctag">@Before</span>(value = &quot;execution(public void com.mms.ba01.ServiceImpl.doSome(String,int))&quot;)</span></span><br><span class="line"><span class="comment">    public void beforeLog() &#123;</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;前置通知-&gt;系统当前时间：&quot; + new Date());</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        前置通知，带方法参数的切面</span></span><br><span class="line"><span class="comment">        切面方法有参数时要求参数是JoinPoint类型，参数名自定义，该参数就代表了连接点方法，即doSome方法</span></span><br><span class="line"><span class="comment">        使用该参数可以获取切入点表达式、切入点方法签名、目标对象等</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before(value = &quot;execution(* *..ServiceImpl.doSome(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeLog</span><span class="params">(JoinPoint jp)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;连接点方法的方法签名=&quot;</span>+jp.getSignature());</span><br><span class="line">        System.out.println(<span class="string">&quot;连接点方法的方法名=&quot;</span>+jp.getSignature().getName());</span><br><span class="line">        <span class="comment">//获取连接点方法参数</span></span><br><span class="line">        Object[] args = jp.getArgs();</span><br><span class="line">        <span class="keyword">for</span> (Object arg : args) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;arg=&quot;</span>+arg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line">    <span class="comment">//aop前置通知</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">config</span> <span class="operator">=</span> <span class="string">&quot;ba01/applicationContext.xml&quot;</span>;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(config);</span><br><span class="line">        <span class="comment">//获取目标对象，此时的service就是spring生成的代理对象</span></span><br><span class="line">        <span class="comment">//注意返回值类型是接口类型，不能是实现类接口，否则报错</span></span><br><span class="line">        <span class="type">IService</span> <span class="variable">service</span> <span class="operator">=</span> (IService) ac.getBean(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        <span class="comment">//使用代理对象执行方法</span></span><br><span class="line">        service.doSome(<span class="string">&quot;张三&quot;</span>,<span class="number">23</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-3-AfterReturning后置通知"><a href="#3-3-3-AfterReturning后置通知" class="headerlink" title="3.3.3 @AfterReturning后置通知"></a><strong>3.3.3 @AfterReturning后置通知</strong></h4><blockquote>
<p>在IService接口中新增方法：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Student <span class="title function_">doStudent</span><span class="params">(Student student)</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在ServiceImpl实现doStudent方法</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Student <span class="title function_">doStudent</span><span class="params">(Student student)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> student;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>切面类代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspectJ</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@AfterReturning</span>: 后置通知，在连接点方法执行之后执行后置通知方法</span></span><br><span class="line"><span class="comment">     * 方法定义格式：</span></span><br><span class="line"><span class="comment">     * 1、公共方法</span></span><br><span class="line"><span class="comment">     * 2、没有返回值</span></span><br><span class="line"><span class="comment">     * 3、方法名称自定义</span></span><br><span class="line"><span class="comment">     * 4、与前置通知一样，可以有JoinPoint类型参数，该参数表示连接点方法对象；还可以有一个</span></span><br><span class="line"><span class="comment">     *    Object类型参数，用于接收连接点方法的执行结果，注意该参数的参数名必须与切入点表达式</span></span><br><span class="line"><span class="comment">     *    的returning属性的属性值一致，表示将returning属性值赋给Object对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">/*@AfterReturning(value = &quot;execution(* *..ServiceImpl.doOther(..))&quot;, returning = &quot;obj&quot;)</span></span><br><span class="line"><span class="comment">        public void afterTransaction(JoinPoint jp, Object obj) &#123;</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;doOther方法的返回参数=&quot;+obj);</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;事务已提交...&quot;);</span></span><br><span class="line"><span class="comment">        经过验证：在后置通知切面内不能改变连接点方法的返回值</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;execution(* *..ServiceImpl.doStudent(..))&quot;, returning = &quot;obj&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterTransaction</span><span class="params">(JoinPoint jp, Object obj)</span> &#123;</span><br><span class="line">        System.out.println(obj);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        student.setName(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">        student.setAge(<span class="number">24</span>);</span><br><span class="line">        obj = student;</span><br><span class="line">        System.out.println(<span class="string">&quot;===查看是否改变了连接点方法的返回值===&quot;</span>+obj);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            经过验证：在后置通知切面内不能改变连接点方法的返回值</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-4-Around环绕通知（功能最强的通知）"><a href="#3-3-4-Around环绕通知（功能最强的通知）" class="headerlink" title="3.3.4 @Around环绕通知（功能最强的通知）"></a><strong>3.3.4 @Around环绕通知（功能最强的通知）</strong></h4><p>环绕通知是功能最强的通知，它的本质就是jdk动态代理，他可以在连接点方法之前和之后都可以执行，最厉害的是他可以改变连接点方法的执行结果（返回结果）。还是拿上面的doStudent(Student student)方法来说明，经过验证前置通知和后置通知都不能改变doStudent(Student student)方法的返回值。下面看一下环绕通知是如何做的。</p>
<blockquote>
<p>切面类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspectJ</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        环绕通知：@Around(切入点表达式)</span></span><br><span class="line"><span class="comment">        1、环绕通知是最重要的一个通知，他表示在连接点方法的前或者后都可以执行，它的本质就是jdk动态代理的invoke</span></span><br><span class="line"><span class="comment">           方法的method参数</span></span><br><span class="line"><span class="comment">        2、定义格式</span></span><br><span class="line"><span class="comment">            a、public</span></span><br><span class="line"><span class="comment">            b、必须有返回值，类型为Object</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around(value = &quot;pointCut()&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        再次回忆一下jdk动态代理的invoke方法的定义</span></span><br><span class="line"><span class="comment">        @Override</span></span><br><span class="line"><span class="comment">        public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">        是不是感觉与下面的方法定义眼熟啊，没错，环绕通知切面的定义实质上就是jdk动态代理</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pj)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;环绕通知在连接点方法之前执行了...&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        result = pj.proceed();</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        student.setName(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">        student.setAge(<span class="number">24</span>);</span><br><span class="line">        <span class="comment">//改变连接点方法返回值</span></span><br><span class="line">        result = student;</span><br><span class="line">        System.out.println(<span class="string">&quot;事务已提交...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        使用pointcut管理切面表达式</span></span><br><span class="line"><span class="comment">        1、在一个切面类中，若多个切面的切面表达式均为同一个，每次都要写重复的代码，此时就可以使用pointcut来</span></span><br><span class="line"><span class="comment">          管理切面表达式了</span></span><br><span class="line"><span class="comment">        2、定义格式：</span></span><br><span class="line"><span class="comment">            公共public</span></span><br><span class="line"><span class="comment">            无返回值</span></span><br><span class="line"><span class="comment">            无参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(value = &quot;execution(* *.doStudent(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//空方法体</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4、整合mybatis"><a href="#4、整合mybatis" class="headerlink" title="4、整合mybatis"></a>4、整合mybatis</h2><h4 id="3-1-梳理整合思路"><a href="#3-1-梳理整合思路" class="headerlink" title="3.1 梳理整合思路"></a><strong>3.1 梳理整合思路</strong></h4><p>所谓的spring整合mybatis就是把两者集成在一起，就像使用一个框架一样。</p>
<p><strong>mybatis框架开发步骤</strong></p>
<blockquote>
<p>定义mapper接口，定义方法<br>定义mapper.xml映射文件<br>创建mybatis核心配置文件<br>创建SqlSession对象，使用该对象生成mapper接口的代理对象执行方法</p>
</blockquote>
<p>spring整合mybatis的核心就是把mybatis开发用到的对象交由spring容器ioc来创建，这样就做到了整合的目的。<br>在开发中，我们一般不使用mybatis自带的数据源，而是使用别的数据源，比如c3p0，dbcp等，本人使用的是阿里的druid数据源。</p>
<h3 id="4-2-整合实现"><a href="#4-2-整合实现" class="headerlink" title="4.2 整合实现"></a>4.2 整合实现</h3><h4 id="4-2-1-环境搭建"><a href="#4-2-1-环境搭建" class="headerlink" title="4.2.1 环境搭建"></a><strong>4.2.1 环境搭建</strong></h4><p>导入相关依赖：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;!--单元测试--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;<span class="number">4.11</span>&lt;/version&gt;</span><br><span class="line">      &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--spring核心ioc--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;<span class="number">5.2</span><span class="number">.5</span>.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;<span class="number">5.2</span><span class="number">.5</span>.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--mybatis依赖--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;<span class="number">3.5</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--mybatis和spring集成的依赖--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;<span class="number">1.3</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--mysql驱动--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;<span class="number">5.1</span><span class="number">.9</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--阿里公司的数据库连接池--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;<span class="number">1.1</span><span class="number">.12</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">  &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">  &lt;build&gt;</span><br><span class="line">    &lt;!--目的是把src/main/java目录中的xml文件包含到输出结果中。输出到classes目录中--&gt;</span><br><span class="line">    &lt;resources&gt;</span><br><span class="line">      &lt;resource&gt;</span><br><span class="line">        &lt;directory&gt;src/main/java&lt;/directory&gt;&lt;!--所在的目录--&gt;</span><br><span class="line">        &lt;includes&gt;&lt;!--包括目录下的.properties,.xml 文件都会扫描到--&gt;</span><br><span class="line">          &lt;include&gt;**<span class="comment">/*.properties&lt;/include&gt;</span></span><br><span class="line"><span class="comment">          &lt;include&gt;**/</span>*.xml&lt;/include&gt;</span><br><span class="line">        &lt;/includes&gt;</span><br><span class="line">        &lt;filtering&gt;<span class="literal">false</span>&lt;/filtering&gt;</span><br><span class="line">      &lt;/resource&gt;</span><br><span class="line">    &lt;/resources&gt;</span><br><span class="line">    &lt;!--指定jdk的版本--&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">      &lt;plugin&gt;</span><br><span class="line">        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">3.1</span>&lt;/version&gt;</span><br><span class="line">        &lt;configuration&gt;</span><br><span class="line">          &lt;source&gt;<span class="number">1.8</span>&lt;/source&gt;</span><br><span class="line">          &lt;target&gt;<span class="number">1.8</span>&lt;/target&gt;</span><br><span class="line">        &lt;/configuration&gt;</span><br><span class="line">      &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">  &lt;/build&gt;</span><br></pre></td></tr></table></figure>

<p><em>重点是注意resources标签的配置，很多人都是在这里出错导致程序运行报错找不到mapper.xml文件</em></p>
<h4 id="4-2-2-案例"><a href="#4-2-2-案例" class="headerlink" title="4.2.2 案例"></a><strong>4.2.2 案例</strong></h4><blockquote>
<p>本案例从student表中查询学生和新增学生功能。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">实体类Student</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> stuNo;</span><br><span class="line">    <span class="keyword">private</span> String stuName;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> cardID;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> classID;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(<span class="type">int</span> stuNo, String stuName, <span class="type">int</span> cardID, <span class="type">int</span> classID)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stuNo = stuNo;</span><br><span class="line">        <span class="built_in">this</span>.stuName = stuName;</span><br><span class="line">        <span class="built_in">this</span>.cardID = cardID;</span><br><span class="line">        <span class="built_in">this</span>.classID = classID;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getStuNo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stuNo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStuNo</span><span class="params">(<span class="type">int</span> stuNo)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stuNo = stuNo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getStuName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stuName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStuName</span><span class="params">(String stuName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stuName = stuName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCardID</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cardID;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCardID</span><span class="params">(<span class="type">int</span> cardID)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cardID = cardID;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getClassID</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> classID;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setClassID</span><span class="params">(<span class="type">int</span> classID)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.classID = classID;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;stuNo=&quot;</span> + stuNo +</span><br><span class="line">                <span class="string">&quot;, stuName=&#x27;&quot;</span> + stuName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, cardID=&quot;</span> + cardID +</span><br><span class="line">                <span class="string">&quot;, classID=&quot;</span> + classID +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>mapper接口</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentMapper</span> &#123;</span><br><span class="line">    <span class="comment">//查询全部</span></span><br><span class="line">    List&lt;Student&gt; <span class="title function_">queryAll</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">//新增学生</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addStudent</span><span class="params">(Student student)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>mapper.xml映射文件</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.mms.mapper.StudentMapper&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--查询全部--&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;queryAll&quot;</span> resultType=<span class="string">&quot;Student&quot;</span>&gt;</span><br><span class="line">        select * from student</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--新增学生--&gt;</span><br><span class="line">    &lt;insert id=<span class="string">&quot;addStudent&quot;</span> parameterType=<span class="string">&quot;Student&quot;</span>&gt;</span><br><span class="line">        insert into <span class="title function_">student</span> <span class="params">(stuno,stuname,cardid,classid)</span></span><br><span class="line">        values (#&#123;stuNo&#125;,#&#123;stuName&#125;,#&#123;cardID&#125;,#&#123;classID&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<p><strong>service接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IStudentService</span> &#123;</span><br><span class="line">    List&lt;Student&gt; <span class="title function_">queryAll</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addStudent</span><span class="params">(Student student)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>service实现类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IStudentService</span> &#123;</span><br><span class="line">    <span class="comment">//mapper属性</span></span><br><span class="line">    <span class="keyword">private</span> StudentMapper mapper;</span><br><span class="line">    <span class="comment">//set注入给mapper对象赋值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMapper</span><span class="params">(StudentMapper mapper)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mapper = mapper;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Student&gt; <span class="title function_">queryAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mapper.queryAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addStudent</span><span class="params">(Student student)</span> &#123;</span><br><span class="line">        mapper.addStudent(student);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>mybatis核心配置文件</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;typeAliases&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">            批量设置别名，会自动的将该包下的所有类定义了别名，别名就是其自身且不区分大小</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;<span class="keyword">package</span> name=<span class="string">&quot;com.mms.entity&quot;</span> /&gt;</span><br><span class="line">    &lt;/typeAliases&gt;</span><br><span class="line">    &lt;!--加载映射配置文件--&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=<span class="string">&quot;com/mms/mapper/studentMapper.xml&quot;</span>&gt;&lt;/mapper&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<p>在这里由于数据源对象我们是交由spring容器托管了，因此mybatsi核心配置文件中就没有environments标签了。</p>
<blockquote>
<p>spring配置文件</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--加载数据库配置文件--&gt;</span><br><span class="line">    &lt;context:property-placeholder location=<span class="string">&quot;classpath:db.properties&quot;</span>/&gt;</span><br><span class="line">    &lt;!--声明数据源--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;myDataSource&quot;</span> class=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span> init-method=<span class="string">&quot;init&quot;</span> destroy-method=<span class="string">&quot;close&quot;</span>&gt;</span><br><span class="line">        &lt;!--set注入给数据库信息赋值，不需要指定驱动类，sprinf根据url自动识别</span><br><span class="line">        &lt;property name=<span class="string">&quot;url&quot;</span> value=<span class="string">&quot;jdbc:mysql://localhost:3306/test?characterEncoding=utf8&amp;amp;useSSL=true&amp;amp;serverTimezone=UTC&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;root&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;333&quot;</span>/&gt;--&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--使用db配置文件读取数据库信息，格式类似el表达式--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;url&quot;</span> value=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--声明的是mybatis中提供的SqlSessionFactoryBean类，这个类内部创建SqlSessionFactory的--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;sqlSessionFactory&quot;</span> class=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span><br><span class="line">        &lt;!--set注入赋值--&gt;</span><br><span class="line">        &lt;!--set注入，把数据库连接池付给了dataSource属性--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;dataSource&quot;</span> ref=<span class="string">&quot;myDataSource&quot;</span> /&gt;</span><br><span class="line">        &lt;!--mybatis主配置文件的位置</span><br><span class="line">           configLocation属性是Resource类型，读取配置文件</span><br><span class="line">           它的赋值，使用value，指定文件的路径，使用classpath:表示文件的位置</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;configLocation&quot;</span> value=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span> /&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--创建dao对象，使用SqlSession的getMapper（StudentDao.class）</span><br><span class="line">        MapperScannerConfigurer:在内部调用getMapper()生成每个dao接口的代理对象。</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;bean class=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span><br><span class="line">        &lt;!--指定SqlSessionFactory对象的id--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;sqlSessionFactoryBeanName&quot;</span> value=<span class="string">&quot;sqlSessionFactory&quot;</span> /&gt;</span><br><span class="line">        &lt;!--指定包名， 包名是dao接口所在的包名。</span><br><span class="line">            MapperScannerConfigurer会扫描这个包中的所有接口，把每个接口都执行</span><br><span class="line">            一次getMapper()方法，得到每个接口的dao对象。</span><br><span class="line">            创建好的dao对象放入到spring的容器中的。 dao对象的默认名称是 接口名首字母小写</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;basePackage&quot;</span> value=<span class="string">&quot;com.mms.mapper&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--声明service--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;studentServiceImpl&quot;</span> class=<span class="string">&quot;com.mms.service.impl.StudentServiceImpl&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;mapper&quot;</span> ref=<span class="string">&quot;studentMapper&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<p><strong>数据库配置文件</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url = jdbc:mysql:<span class="comment">//localhost:3306/Xxx?characterEncoding=utf8&amp;useSSL=true&amp;serverTimezone=UTC</span></span><br><span class="line">username = <span class="type">Xxx</span></span><br><span class="line"><span class="variable">password</span> <span class="operator">=</span> Xxx</span><br></pre></td></tr></table></figure>

<p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//执行查询全部，不使用service</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">config</span> <span class="operator">=</span> <span class="string">&quot;applicationContext.xml&quot;</span>;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(config);</span><br><span class="line">        <span class="comment">//获取mapper的代理对象</span></span><br><span class="line">        <span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> (StudentMapper) ac.getBean(<span class="string">&quot;studentMapper&quot;</span>);</span><br><span class="line">        List&lt;Student&gt; students = mapper.queryAll();</span><br><span class="line">        <span class="keyword">for</span> (Student student : students) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;student---&gt;&quot;</span>+student);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行增加学生，使用service</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">config</span> <span class="operator">=</span> <span class="string">&quot;applicationContext.xml&quot;</span>;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(config);</span><br><span class="line">        <span class="comment">//获取service对象</span></span><br><span class="line">        <span class="type">IStudentService</span> <span class="variable">service</span> <span class="operator">=</span> (IStudentService) ac.getBean(<span class="string">&quot;studentServiceImpl&quot;</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        student.setStuName(<span class="string">&quot;呵呵&quot;</span>);</span><br><span class="line">        student.setStuNo(<span class="number">1111</span>);</span><br><span class="line">        student.setCardID(<span class="number">1115</span>);</span><br><span class="line">        student.setClassID(<span class="number">1</span>);</span><br><span class="line">        service.addStudent(student);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="5、处理事务"><a href="#5、处理事务" class="headerlink" title="5、处理事务"></a>5、处理事务</h2><p><strong>5.1 什么是事务</strong><br>事务是指一组sql语句的集合， 集合中有多条sql语句可能是insert ， update ，select ，delete， 我们希望这些多个sql语句都能成功，或者都失败， 这些sql语句的执行是一致的，作为一个整体执行。关于事务最经典的例子就是转账了。</p>
<h3 id="5-2-使用spring内部注解处理事务"><a href="#5-2-使用spring内部注解处理事务" class="headerlink" title="5.2 使用spring内部注解处理事务"></a><strong>5.2 使用spring内部注解处理事务</strong></h3><p><em>加入事务相关依赖</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;spring-tx&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;<span class="number">5.2</span><span class="number">.5</span>.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>案例：数据库有两张表，一张sale表，该表是商品订单信息；一张goods表，该表是商品库存信息。service类有一个业务方法buy，该方法指定要购买商品的id和数量，dao有三个方法分别是像sale表增加一条购买记录、更新goods表的库存信息、在goods表查询指定id商品是否存在。<br>下面是两张表的记录信息</p>
<p><strong>sale表（初始是空表，因为还没有购买记录），id字段自增长</strong>  </p>
<p><img src="https://pic2.zhimg.com/80/v2-cea79496ebf16142c2bad34c1a539a21_720w.webp"></p>
<p><strong>goods表</strong>  </p>
<p><img src="https://pic2.zhimg.com/80/v2-6730af9529f6c2238d08e2ae4ff0d591_720w.webp"></p>
<p>业务流程大致是这样，用户向buy方法传递两个参数，分别是goods表的id字段和购买数量nums。buy方法体中的第一个方法是向sale表增加一条记录，类似与buy(1002,20)，那么sale表应该多出来一条如下记录</p>
<p><img src="https://pic1.zhimg.com/80/v2-b1053aec30cc9ef6139e3b7be0a14d50_720w.webp"></p>
<p>因为sale表id字段是自增长的，所以自动为1。</p>
<p><strong>先看一下buy方法的定义</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buy</span><span class="params">(Integer goodsId, Integer nums)</span> &#123;</span><br><span class="line">        <span class="comment">//sale表新增购买记录</span></span><br><span class="line">        <span class="comment">//更新库存</span></span><br><span class="line">        <span class="comment">//先查询该编号的商品是否存在</span></span><br><span class="line">        <span class="type">Goods</span> <span class="variable">goods</span> <span class="operator">=</span> goodsMapper.queryGoods(goodsId);</span><br><span class="line">        <span class="comment">//进行判断</span></span><br><span class="line">        <span class="keyword">if</span> (goods == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//说明商品不存在</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (goods.getAmount() &lt; nums) &#123;</span><br><span class="line">            <span class="comment">//说明库存不足</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//能够进行到这里说明商品信息是合法的，可以更新库存</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>首先根据用户传入的参数id和nums向sale表新增一条购买记录。即有商品卖出去了，那么我们理应更新一下库存对吧，不然怎么知道还有多少货，万一别人要买100件商品而你只有50件肯定会导致别人购买失败对吧。那么问题就就来了，当我们执行完向sale表新增记录后，就该更新库存了，我们必须要知道刚卖出去的商品是谁对吧，这个通过用户传入的id和商品表goods的id字段一一对应，所以先去数据库查询用户传入的id是否存在goods表中，若不存在应该将事务回滚，即前面向sale表增加的记录是不应该存在的；同理，若用户传入的id商品在goods表中，但是用户要求的数量大于该商品当前库存，事务也应该回滚；只有当用户传入的id商品和数量都满足条件时我们才应该更新库存并且提交事务。<br>该介绍的都介绍完了，开始着手干吧。</p>
<p><strong>实体类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Goods</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer amount;</span><br><span class="line">    <span class="keyword">private</span> Float price;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Goods</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Goods</span><span class="params">(Integer id, String name, Integer amount, Float price)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.amount = amount;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getAmount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> amount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAmount</span><span class="params">(Integer amount)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.amount = amount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Float <span class="title function_">getPrice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(Float price)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Goods&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, amount=&quot;</span> + amount +</span><br><span class="line">                <span class="string">&quot;, price=&quot;</span> + price +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sale</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Integer gid;</span><br><span class="line">    <span class="keyword">private</span> Integer nums;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Sale</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Sale</span><span class="params">(Integer id, Integer gid, Integer nums)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.gid = gid;</span><br><span class="line">        <span class="built_in">this</span>.nums = nums;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getGid</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> gid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGid</span><span class="params">(Integer gid)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.gid = gid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getNums</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNums</span><span class="params">(Integer nums)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.nums = nums;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Sale&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, gid=&quot;</span> + gid +</span><br><span class="line">                <span class="string">&quot;, nums=&quot;</span> + nums +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>mapper接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GoodsMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新库存</span></span><br><span class="line"><span class="comment">     * goods表示本次用户购买的商品信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> goods</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateGoods</span><span class="params">(Goods goods)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询商品信息</span></span><br><span class="line">    Goods <span class="title function_">queryGoods</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SaleMapper</span> &#123;</span><br><span class="line">    <span class="comment">//增加销售记录</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addSale</span><span class="params">(Sale sale)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>mapper.xml映射文件</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace=<span class="string">&quot;com.mms.mapper.GoodsMapper&quot;</span>&gt;</span><br><span class="line">    &lt;!--更新商品信息--&gt;</span><br><span class="line">    &lt;update id=<span class="string">&quot;updateGoods&quot;</span> parameterType=<span class="string">&quot;Goods&quot;</span>&gt;</span><br><span class="line">        update goods <span class="type">set</span> <span class="variable">amount</span> <span class="operator">=</span> amount - #&#123;amount&#125; <span class="type">where</span> <span class="variable">id</span> <span class="operator">=</span> #&#123;id&#125;</span><br><span class="line">    &lt;/update&gt;</span><br><span class="line">    &lt;!--查询商品信息--&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;queryGoods&quot;</span> resultType=<span class="string">&quot;Goods&quot;</span>&gt;</span><br><span class="line">        select * from goods <span class="type">where</span> <span class="variable">id</span> <span class="operator">=</span> #&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.mms.mapper.SaleMapper&quot;</span>&gt;</span><br><span class="line">    &lt;!--增加销售记录--&gt;</span><br><span class="line">    &lt;insert id=<span class="string">&quot;addSale&quot;</span> parameterType=<span class="string">&quot;Sale&quot;</span>&gt;</span><br><span class="line">        insert into <span class="title function_">sale</span> <span class="params">(gid,nums)</span> values (#&#123;gid&#125;,#&#123;nums&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<p><strong>service接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IBuyGoodsService</span> &#123;</span><br><span class="line">    <span class="comment">//购买商品的方法，goodsId是购买商品的编号，nums是购买商品的数量</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">buy</span><span class="params">(Integer goodsId,Integer nums)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>service实现类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BuyGoodsServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IBuyGoodsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SaleMapper saleMapper;</span><br><span class="line">    <span class="keyword">private</span> GoodsMapper goodsMapper;</span><br><span class="line">    <span class="comment">//set注入赋值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSaleMapper</span><span class="params">(SaleMapper saleMapper)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.saleMapper = saleMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGoodsMapper</span><span class="params">(GoodsMapper goodsMapper)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.goodsMapper = goodsMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 购买商品方法</span></span><br><span class="line"><span class="comment">     * goodsId表示要购买的商品编号，nums表示购买的数量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> goodsId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nums</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        1、@Transactional定义在需要加入事务处理的方法上面</span></span><br><span class="line"><span class="comment">        2、rollbackFor</span></span><br><span class="line"><span class="comment">            1）当方法发生的异常属于rollbackFor，事务就会回滚</span></span><br><span class="line"><span class="comment">            2）当方法发生的异常不属于rollbackFor，spring就会判断发生的异常是不是运行时异常，</span></span><br><span class="line"><span class="comment">               若是运行时异常，事务就会回滚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    @Transactional(</span></span><br><span class="line"><span class="comment">            propagation = Propagation.REQUIRED,</span></span><br><span class="line"><span class="comment">            isolation = Isolation.DEFAULT,</span></span><br><span class="line"><span class="comment">            readOnly = false,</span></span><br><span class="line"><span class="comment">            rollbackFor = &#123;</span></span><br><span class="line"><span class="comment">                    NullPointerException.class,</span></span><br><span class="line"><span class="comment">                    NotEnoughException.class</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    )*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//开发中推荐使用默认值，直接使用@Transactional注解</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buy</span><span class="params">(Integer goodsId, Integer nums)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;buy开始...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            记录销售的信息，向sale表添加记录，由于sale表id是自增长的，所以不需要设置id属性</span></span><br><span class="line"><span class="comment">            向sale表添加一条购买记录</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">Sale</span> <span class="variable">sale</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sale</span>();</span><br><span class="line">        sale.setGid(goodsId);</span><br><span class="line">        sale.setNums(nums);</span><br><span class="line">        saleMapper.addSale(sale);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//更新库存</span></span><br><span class="line">        <span class="comment">//先查询该编号的商品是否存在</span></span><br><span class="line">        <span class="type">Goods</span> <span class="variable">goods</span> <span class="operator">=</span> goodsMapper.queryGoods(goodsId);</span><br><span class="line">        <span class="comment">//进行判断</span></span><br><span class="line">        <span class="keyword">if</span> (goods == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//说明商品不存在</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;编号为:&quot;</span>+goodsId+<span class="string">&quot;商品不存在...&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (goods.getAmount() &lt; nums) &#123;</span><br><span class="line">            <span class="comment">//说明库存不足</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NotEnoughException</span>(<span class="string">&quot;编号为:&quot;</span>+goodsId+<span class="string">&quot;商品库存不足...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//能够进行到这里说明商品信息是合法的，可以更新库存</span></span><br><span class="line">        <span class="type">Goods</span> <span class="variable">good</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Goods</span>();</span><br><span class="line">        good.setId(goodsId);</span><br><span class="line">        good.setAmount(nums);</span><br><span class="line">        goodsMapper.updateGoods(good);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;buy结束...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>mybatis核心配置文件和整合mybatis一致，这里就不给出了<br>spring配置文件也和整合部分一致，只需要在根标签beans加入以下部分即可</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--声明使用spring的事务处理--&gt;</span><br><span class="line">    &lt;!--<span class="number">1</span>、声明事务管理器--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;transactionManager&quot;</span> class=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span><br><span class="line">        &lt;!--连接的数据库，指定数据源--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;dataSource&quot;</span> ref=<span class="string">&quot;myDataSource&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!--<span class="number">2</span>、开启事务注解驱动，告诉sprint使用注解管理事务，创建代理对象--&gt;</span><br><span class="line">    &lt;tx:annotation-driven transaction-manager=<span class="string">&quot;transactionManager&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p><strong>测试类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//不使用事务测试</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">config</span> <span class="operator">=</span> <span class="string">&quot;applicationContext.xml&quot;</span>;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(config);</span><br><span class="line">        <span class="comment">//获取service对象</span></span><br><span class="line">        <span class="type">IBuyGoodsService</span> <span class="variable">service</span> <span class="operator">=</span> (IBuyGoodsService) ac.getBean(<span class="string">&quot;buyGoodsService&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//商品编号不存在情况</span></span><br><span class="line">        <span class="comment">//java.lang.NullPointerException: 编号为:1003商品不存在...</span></span><br><span class="line">        <span class="comment">//service.buy(1003,50);</span></span><br><span class="line">        <span class="comment">//商品库存不足情况</span></span><br><span class="line">        <span class="comment">//com.mms.exception.NotEnoughException: 编号为:1002商品库存不足...</span></span><br><span class="line">        <span class="comment">//service.buy(1002,100);</span></span><br><span class="line">        <span class="comment">//正常情况</span></span><br><span class="line">        service.buy(<span class="number">1002</span>,<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-使用aspectj框架处理事务"><a href="#5-3-使用aspectj框架处理事务" class="headerlink" title="5.3 使用aspectj框架处理事务"></a><strong>5.3 使用aspectj框架处理事务</strong></h3><p>aspectJ处理事务是基于配置文件形式的，别的地方都和上面一样，只需要更改service实现类的buy方法和spring核心配置文件即可。</p>
<blockquote>
<p>1、取消buy方法上的事务注解，因为我们现在是使用aspectJ，基于配置文件<br>2、将spring注解形式事务开发的spring配置文件中加入的声明事务管理器的部分换成下面的配置</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">       使用aspectj方式的事务（声明式事务）</span><br><span class="line">       <span class="number">1</span>、aspectj事务适合大型项目，因为其声明在配置文件中，大大与程序解耦合</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;!--<span class="number">1</span>、声明事务管理器--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;transactionManager&quot;</span> class=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;dataSource&quot;</span> ref=<span class="string">&quot;myDataSource&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">        <span class="number">2</span>、声明业务方法的事务属性（隔离级别、传播行为、超时时间）</span><br><span class="line">            id：自定义</span><br><span class="line">            transaction-manager：事务故管理器对象的id值</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;tx:advice id=<span class="string">&quot;myAdvice&quot;</span> transaction-manager=<span class="string">&quot;transactionManager&quot;</span>&gt;</span><br><span class="line">        &lt;!--tx:attributes配置事务属性--&gt;</span><br><span class="line">        &lt;tx:attributes&gt;</span><br><span class="line">            &lt;!--</span><br><span class="line">                tx:method：给具体的方法配置事务属性，method可以有多个，由于给多个方法配置事务</span><br><span class="line">                name：方法名，不带包名和类名，方法可以使用通配符</span><br><span class="line">                propagation：传播行为，枚举类</span><br><span class="line">                isolation：隔离级别</span><br><span class="line">                rollback-<span class="keyword">for</span>：你指定的异常全限定类名，发生异常一定回滚</span><br><span class="line">            --&gt;</span><br><span class="line">            &lt;tx:method name=<span class="string">&quot;buy&quot;</span></span><br><span class="line">                       propagation=<span class="string">&quot;REQUIRED&quot;</span></span><br><span class="line">                       isolation=<span class="string">&quot;DEFAULT&quot;</span></span><br><span class="line">                       rollback-<span class="keyword">for</span>=<span class="string">&quot;java.lang.NullPointerException,com.mms.exception.NotEnoughException&quot;</span>/&gt;</span><br><span class="line">        &lt;/tx:attributes&gt;</span><br><span class="line">    &lt;/tx:advice&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;aop:config&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">        <span class="number">3</span>、配置切入点表达式</span><br><span class="line">        为什么需要配置切入点表达式？</span><br><span class="line">            因为步骤<span class="number">2</span>中的方法不确定是哪一个类、哪一个包的方法，所以需要指定</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;aop:pointcut id=<span class="string">&quot;servicePt&quot;</span> expression=<span class="string">&quot;execution(* *..service..*.*(..))&quot;</span>/&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">            配置增强器，用于关联advice和pointcut</span><br><span class="line">            advice-ref：通知，上面的tx:advice的id值</span><br><span class="line">            pointcut-ref：切入点表达式的id值</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;aop:advisor advice-ref=<span class="string">&quot;myAdvice&quot;</span> pointcut-ref=<span class="string">&quot;servicePt&quot;</span>/&gt;</span><br><span class="line">    &lt;/aop:config&gt;</span><br></pre></td></tr></table></figure>

<p><strong>测试类与前面的一样。</strong></p>

	  <div class="article-footer-copyright">

    本博客采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议(CC BY-NC-SA 4.0) 发布.</a>
</div>

	</div>

	<!-- 
		<span id="/2024/02/22/J-Spring/" class="leancloud-visitors view" data-flag-title="J-Spring">
			<i class="fa fa-eye"></i> <i class="leancloud-visitors-count"></i>
		</span>
	 -->
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a type="button" class="btn btn-default disabled"><i class="fa fa-arrow-circle-o-left"></i>Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2024/02/13/J-Mybatis/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
		<section id="comments" class="comments">
			<style>
			.comments{margin:30px;padding:10px;background:rgb(0, 0, 0)}
			@media screen and (max-width:800px){.comments{margin:auto;padding:10px;background:#000}}
			</style>
			<div id="vcomment" class="comment"></div>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script src="https://cdnjs.loli.net/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
var valineConfig = {"enable":true,"appId":"7m4bFydh606FgGbxRPsI8M6l-gzGzoHsz","appKey":"edXvAXhOXIvksZqtq8b5AXWj","placeholder":"input your comment: ","visitor":true,"avatar":"retro","lang":"en","metaPlaceholder":{"nick":"nick","mail":"mail","link":"link"},"requiredFields":["nick","mail","link"],"pageView":true}
valineConfig.el='#vcomment';
new Valine(valineConfig);
    // new Valine({
    //     el: '#vcomment',
    //     appId: "",
    //     appKey: "",
    //     placeholder: "input your comment: ",
    //     avatar:"retro",
    //     visitor: "true",
    //     requiredFields: "nick,mail,link".split(','),
    // });
</script>

		</section>
	
	
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2024-02-22 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/Java/">Java<span>2</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer>  </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



</body>
   </html>
